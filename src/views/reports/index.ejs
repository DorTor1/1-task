<% layout('layout') %>
<h1>Отчёты</h1>
<section>
  <h2>По статусам</h2>
  <div class="chart-wrapper">
    <canvas id="statusChart"></canvas>
  </div>
</section>

<section>
  <h2>По приоритетам</h2>
  <div class="chart-wrapper">
    <canvas id="priorityChart"></canvas>
  </div>
</section>

<section>
  <h2>По проектам</h2>
  <div class="chart-wrapper">
    <canvas id="projectChart"></canvas>
  </div>
</section>

<p>
  <a href="/reports/export/csv">Экспорт CSV</a>
  <a href="/reports/export/xlsx">Экспорт Excel</a>
  
</p>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const statusChart = <%- JSON.stringify(statusChart) %>;
  const priorityChart = <%- JSON.stringify(priorityChart) %>;
  const projectChart = <%- JSON.stringify(projectChart) %>;

  const charts = [
    { id: 'statusChart', data: statusChart },
    { id: 'priorityChart', data: priorityChart },
    { id: 'projectChart', data: projectChart },
  ];

  charts.forEach(({ id, data }) => {
    const canvas = document.getElementById(id);
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: data.labels,
        datasets: [{ label: 'Количество', data: data.counts, backgroundColor: '#0d47a1' }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: { beginAtZero: true, ticks: { precision: 0 } },
        },
      }
    });
  });
</script>

